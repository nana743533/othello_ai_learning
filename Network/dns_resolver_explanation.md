# C言語で作る「ドメイン名 → IPアドレス変換」プログラム解説

このドキュメントでは、`Network/example.c` のコードについて、C言語初心者の方にも分かりやすいように解説します。

## プログラムの目的

「google.com」のような人間が覚えやすい名前（ドメイン名）から、「142.250.xxx.xxx」のようなコンピュータが使う住所（IPアドレス）を調べるプログラムです。これを「名前解決（DNS解決）」と呼びます。

## コードの全体像と解説

### 1. 必要なライブラリの読み込み
```c
#include <stdio.h>      // 画面表示用 (printfなど)
#include <stdlib.h>     // 一般的な機能用
#include <string.h>     // メモリ操作用 (memsetなど)
#include <sys/types.h>  // システムの型定義
#include <sys/socket.h> // ソケット通信用
#include <netdb.h>      // DNS解決用 (getaddrinfoなど)
#include <arpa/inet.h>  // IPアドレス変換用 (inet_ntopなど)
```
ネットワークプログラミングには、上記のように多くの「ヘッダーファイル」が必要です。これらは「OSが提供するネットワーク機能を使うための準備」だと思ってください。

### 2. ポインタと構造体
ネットワークプログラミングでは「構造体（データのセット）」と「ポインタ（場所を指す矢印）」が頻出します。

- `struct addrinfo`: 「IPアドレス」「通信タイプ」「プロトコル」などの情報をひとまとめにしたセットです。
- `hints`: 「こんなIPアドレスを探してね」という希望条件を書くメモ帳です。
- `res`: 検索結果（見つかったIPアドレス情報）を受け取るためのポインタです。

### 3. 初期化 (`memset`)
```c
memset(&hints, 0, sizeof hints);
```
C言語では、変を作っただけでは中身にゴミが入っていることがあります。`memset` で `hints` 構造体の中身を全部 0 で埋めて（クリアして）います。これはバグを防ぐための重要なお作法です。

### 4. 検索条件の設定
```c
hints.ai_family = AF_UNSPEC;     // IPv4とIPv6、どっちでもOK！
hints.ai_socktype = SOCK_STREAM; // TCPという一般的な通信方式を使いたい
```
- `AF_UNSPEC`: Protocol Family Unspecified（指定なし）。ここを `AF_INET` にするとIPv4だけ、`AF_INET6` にするとIPv6だけを検索します。

### 5. メインの処理: `getaddrinfo`
```c
status = getaddrinfo(argv[1], NULL, &hints, &res);
```
これがこのプログラムの主役です！
- **入力**: 第一引数（ドメイン名）、条件メモリ（hints）
- **出力**: 結果（res）
- もし成功すれば 0 が返り、失敗すればエラーコードが返ります。

### 6. 結果の取り出しと表示
`getaddrinfo` の結果は「リンクリスト」という数珠（じゅず）繋ぎの状態で返ってきます。なぜなら、1つのドメイン名に対して、IPv4とIPv6など複数のIPアドレスが割り当てられていることが多いからです。

```c
// res からスタートして、次のデータ(ai_next)がなくなるまで繰り返す
for(p = res; p != NULL; p = p->ai_next) {
    // ...
}
```

#### IPアドレスの変換 (`inet_ntop`)
コンピュータ内部では、IPアドレスは単なる「数字の羅列（バイナリ）」として扱われています。これを人間が見てわかる「192.168.1.1」のような文字に変換するのが `inet_ntop` 関数です。
- `ntop` は **N**etwork **to** **P**resentation（ネットワーク形式から表示形式へ）の略です。

### 7. 後片付け
```c
freeaddrinfo(res);
```
C言語では、使ったメモリは自分で片付ける必要があります。`getaddrinfo` が確保してくれたメモリ（`res`）を解放しています。

## まとめ

このプログラムの流れは以下の通りです。

1.  **準備**: どんなIPが欲しいか条件を書く (`hints`)
2.  **問い合わせ**: OSに「このドメインのIP教えて！」と聞く (`getaddrinfo`)
3.  **表示**: 返ってきた結果（複数あるかも）を順番に表示する (`for`ループ)
4.  **片付け**: 使ったメモリを返す (`freeaddrinfo`)

これで、C言語を使った基本的なネットワークの名前解決ができるようになります！
